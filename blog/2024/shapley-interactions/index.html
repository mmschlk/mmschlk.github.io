<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>What Are Shapley Interactions, and Why Should You Care? | Maximilian Muschalik</title> <meta name="author" content="Maximilian Muschalik"> <meta name="description" content="A gentle introduction to Shapley interactions and why they matter."> <meta name="keywords" content="maximilian, muschalik, dynxai, portfolio-website, personal website, maximilian muschalik, xai, machine learning, artificial intelligence, explainable artificial intelligence, online learning, incremental learning"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9C%8C%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://mmschlk.github.io/blog/2024/shapley-interactions/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Maximilian </span>Muschalik</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Open Source</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">What Are Shapley Interactions, and Why Should You Care?</h1> <p class="post-meta">December 5, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/formatting"> <i class="fas fa-hashtag fa-sm"></i> formatting</a>   <a href="/blog/tag/images"> <i class="fas fa-hashtag fa-sm"></i> images</a>     ·   <a href="/blog/category/shapley-interactions"> <i class="fas fa-tag fa-sm"></i> shapley-interactions</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="what-are-shapley-interactions-and-why-should-you-care">What Are Shapley Interactions, and Why Should You Care?</h1> <p>Shapley values are the go-to method for explainable AI because they are easy to interpret and theoretically well-founded. However, they struggle to capture the interplay between features. About two years ago, we attended a talk that introduced the concept of <strong>Shapley interactions</strong>, and we quickly realized that Shapley interactions were exactly the solution to our problem! Unfortunately, the presenter also mentioned that calculating Shapley interaction values is extremely difficult, if not impossible. We started experimenting a bit and soon came up with a preliminary approach to compute Shapley interactions for any machine learning model. After receiving positive feedback and growing interest from the community, we realized that this research gap was a perfect opportunity to pursue our own interests and create impact for others. That’s when our <a href="https://github.com/mmschlk/shapiq" rel="external nofollow noopener" target="_blank"><strong>shapiq</strong></a> project was born. Here, we want to tell you <em>what Shapley interactions are and why you should care</em>.</p> <h2 id="what-are-interactions">What Are Interactions?</h2> <p>Imagine you’re working with the California housing dataset and we want to predict house prices. Features like location, median income, and year built all play a role. Location, for example, is represented by longitude (west-east) and latitude (north-south). But here’s the twist: looking at longitude or latitude individually doesn’t tell the whole story. It’s their combination—pinpointing the exact location—that influences house prices.</p> <p>Take two houses (with otherwise similar properties) near the ocean:</p> <ul> <li>Close to San Francisco: $454,000.</li> <li>Far from major hotspots: $210,000.</li> </ul> <p>This difference isn’t explained by longitude or latitude alone but by their interaction. Interactions capture the idea that one feature’s influence (longitude) depends on the value of another (latitude).</p> <h2 id="limitations-of-shapley-values">Limitations of Shapley Values</h2> <p>Shapley values are popular because they distribute the effects of features fairly. For example, if you explain the above-mentioned house in San Francisco with a predicted house price of 454,000$, Shapley values show that both longitude and latitude positively contribute (see image below). But there’s a problem: Shapley values merge individual effects and interaction effects into a single number. This means:</p> <ul> <li>We can’t tell how much of a feature’s influence is individual versus interactive.</li> <li>We don’t know which other features it interacts with.</li> </ul> <p><img src="/assets/img/blog_post_shapley_interaction_1.png" alt="example showing shapley values" width="650"></p> <h2 id="enter-shapley-interactions">Enter Shapley Interactions</h2> <p>Shapley interactions enhance the traditional Shapley value approach by breaking down the effects of features into <strong>individual contributions</strong> and <strong>interactions between features</strong>. Instead of providing a single value per feature, Shapley interactions distribute the prediction’s influence across both individual features and groups of interacting features. So for each combination of features we, potentially, can get a value of an interaction.</p> <p>Let’s return to our <strong>California housing</strong> example, the decomposition up to order 2 compared to order 1 (Shapley value) shows that:</p> <ul> <li>Longitude has a high individual contribution, showing the importance of proximity to the ocean.</li> <li>Latitude, however, has little individual impact, with its contribution coming entirely from its interaction with longitude (in the image below latitude’s contribution vanishes but the interaction between longitude and latitude appears).</li> <li>This interaction captures how the combination of longitude and latitude identifies high-value locations, like San Francisco.</li> </ul> <p>By predefining a <strong>maximum interaction order,</strong> you can control how detailed the analysis gets. Setting it to second-order interactions, for instance, allows you to explore how pairs of features interact (like longitude and latitude) while still capturing individual effects. This provides a richer understanding of how features influence predictions—whether independently or through their interplay.</p> <p><img src="/assets/img/blog_post_shapley_interaction_2.png" alt="example showing shapley interactions" width="650"></p> <p>Hence, Shapley interactions give you more granular insights into the relationships driving model predictions, helping <strong>uncover synergies or redundancies that traditional Shapley values can’t</strong>. One of the main takeaways here is that we can interpret Shapley interactions like you are used to with SHAP, while providing more information. This level of detail, however, can come with a cost.</p> <h2 id="balancing-insights-and-complexity">Balancing Insights and Complexity</h2> <p>The more interactions we analyze (higher-order decompositions), the more insights we uncover. <strong>But there’s a tradeoff:</strong> explanations become more complex and harder to interpret (because we have way more values/interactions to analyze). Striking the right balance between depth and simplicity depends on your goals.</p> <h2 id="computing-shapley-interactions-in-python-with-shapiq">Computing Shapley Interactions in Python with shapiq</h2> <p>If you’re curious about how to compute these decompositions or visualize them, check out our <strong><a href="https://github.com/mmschlk/shapiq" rel="external nofollow noopener" target="_blank">shapiq package</a></strong> for an easy way to explore Shapley interactions and uncover new insights! Currently, we offer a range of model-agnostic and model-specific explainers and computation methods, which you can use to calculate Shapley interactions and Shapley values for all data types and model kinds. Check out the tutorial notebooks on how to use it for your task.</p> <p><img src="/assets/img/blog_post_shapley_interaction_3.png" alt="an image showing what shapiq contains" width="650"></p> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Maximilian Muschalik. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Last updated: December 05, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>